{% extends 'base.html' %}
{% block content %}
<article class="card card--full">
  <header style="display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:1rem 1.25rem;">
    <h2 style="margin:0">Клиенты</h2>
    <div class="toolbar" style="margin-left:auto">
      <input id="clientSearch" type="search" placeholder="Поиск по имени" />
      <a href="/clients/create/" class="btn btn-primary btn-sm">+ Добавить клиента</a>
    </div>
  </header>

  <div class="table-wrapper">
    <table class="table-fixed table-clients">
      <colgroup>
        <col class="c-name">
        <col class="c-count">
        <col class="c-actions">
      </colgroup>
      <thead>
        <tr>
          <th>Имя</th>
          <th>Заполнено</th>
          <th class="actions-col">Действия</th>
        </tr>
      </thead>
      <tbody id="clientTable">
        {% for c in clients %}
        {% with filled=c.attributes|length total=total_entities %}
        {% widthratio filled total 100 as pct %}
        <tr data-name="{{ c.name|lower }}">
          <td class="wrap"><div class="clamp-2" title="{{ c.name }}">{{ c.name }}</div></td>
          <td>
            <div class="progress" title="{{ filled }}/{{ total }}">
              <div style="width: {{ pct }}%"></div>
            </div>
            <small class="muted">{{ filled }}/{{ total }}</small>
          </td>
          <td class="actions-col">
            <div class="action-stack">
              <a href="/clients/{{ c.id }}/edit/" class="btn btn-primary btn-sm">Изменить</a>
              <a href="/clients/{{ c.id }}/delete/" class="btn btn-outline btn-danger btn-sm">Удалить</a>
            </div>
          </td>
        </tr>
        {% endwith %}
        {% empty %}
        <tr><td colspan="3">Пока нет клиентов</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</article>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    const input = document.getElementById('clientSearch');
    if(!input) return;
    const rows = Array.from(document.querySelectorAll('#clientTable tr'));
    input.addEventListener('input', function(){
      const t = this.value.toLowerCase().trim();
      rows.forEach(r => {
        const name = r.getAttribute('data-name') || '';
        r.style.display = (t === '' || name.includes(t)) ? '' : 'none';
      });
    });
  });
</script>
{% endblock %}
